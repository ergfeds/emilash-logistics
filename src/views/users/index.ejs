<% layout('layouts/admin') %>

<div class="row mb-4">
	<div class="col-md-8">
		<h1 class="h3 mb-0">ğŸ‘¥ User Management</h1>
		<p class="text-muted">Manage admin and staff users</p>
	</div>
	<div class="col-md-4 text-end">
		<a href="/admin/users/new" class="btn btn-primary">
			â• New User
		</a>
	</div>
</div>

<div class="card">
	<div class="table-responsive">
		<table class="table table-hover align-middle mb-0">
			<thead>
				<tr>
					<th>ğŸ‘¤ User</th>
					<th>ğŸ“§ Email</th>
					<th>ğŸ·ï¸ Role</th>
					<th>ğŸ“… Created</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				<% if (users && users.length) { %>
					<% users.forEach(u => { %>
						<tr>
							<td>
								<div class="fw-bold"><%= u.name %></div>
								<small class="text-muted">#<%= u.id %></small>
							</td>
							<td><%= u.email %></td>
							<td>
								<span class="badge <%= u.role === 'admin' ? 'bg-primary' : 'bg-secondary' %>">
									<%= u.role.toUpperCase() %>
								</span>
							</td>
							<td>
								<%= new Date(u.created_at).toLocaleDateString() %>
								<br>
								<small class="text-muted"><%= new Date(u.created_at).toLocaleTimeString() %></small>
							</td>
							<td>
								<div class="btn-group btn-group-sm">
									<a class="btn btn-outline-secondary" href="/admin/users/<%= u.id %>/edit" title="Edit">âœï¸</a>
									<% if (currentUser.id !== u.id) { %>
										<form method="post" action="/admin/users/<%= u.id %>?_method=DELETE" class="d-inline" onsubmit="return confirm('Delete this user?')">
											<button class="btn btn-outline-danger btn-sm" title="Delete">ğŸ—‘ï¸</button>
										</form>
									<% } else { %>
										<button class="btn btn-outline-secondary btn-sm" disabled title="Cannot delete yourself">ğŸ”’</button>
									<% } %>
								</div>
							</td>
						</tr>
					<% }) %>
				<% } else { %>
					<tr>
						<td colspan="5" class="text-center py-5">
							<div class="text-muted">
								<h5>ğŸ‘¥ No users found</h5>
								<p><a href="/admin/users/new">Create your first user</a></p>
							</div>
						</td>
					</tr>
				<% } %>
			</tbody>
		</table>
	</div>
</div>

