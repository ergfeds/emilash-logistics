<% layout('layouts/admin') %>
<div class="d-flex justify-content-between align-items-center mb-3">
	<h1 class="h4 m-0">Shipment <span class="text-muted">#<%= shipment.tracking_number %></span></h1>
	<div>
		<a href="/admin/shipments/<%= shipment.id %>/edit" class="btn btn-outline-secondary">Edit</a>
		<a href="/admin/shipments" class="btn btn-link">Back</a>
	</div>
</div>
<div class="row g-3">
	<div class="col-md-6">
		<div class="card h-100 shadow-sm">
			<div class="card-header">Details</div>
			<div class="card-body">
				<div class="row mb-2">
					<div class="col-4 text-muted">Sender</div>
					<div class="col-8"><%= shipment.sender_name %> <small class="text-muted"><%= shipment.sender_email || '' %> <%= shipment.sender_phone || '' %></small></div>
				</div>
				<div class="row mb-2">
					<div class="col-4 text-muted">Receiver</div>
					<div class="col-8"><%= shipment.receiver_name %> <small class="text-muted"><%= shipment.receiver_email || '' %> <%= shipment.receiver_phone || '' %></small></div>
				</div>
				<div class="row mb-2">
					<div class="col-4 text-muted">Route</div>
					<div class="col-8"><%= shipment.origin || '-' %> → <%= shipment.destination || '-' %></div>
				</div>
				<div class="row mb-2">
					<div class="col-4 text-muted">Status</div>
					<div class="col-8"><span class="badge" style="background:<%= shipment.status_color || '#6c757d' %>"><%= shipment.status_name || 'N/A' %></span></div>
				</div>
				<div class="row mb-2">
					<div class="col-4 text-muted">ETA</div>
					<div class="col-8"><%= shipment.eta ? new Date(shipment.eta).toLocaleString() : '-' %></div>
				</div>
				<div class="mb-2"><span class="text-muted">Package:</span> <%= shipment.package_description || '-' %></div>
			</div>
		</div>
	</div>
	<div class="col-md-6">
		<div class="card shadow-sm">
			<div class="card-header">Add Status Update</div>
			<div class="card-body">
				<form method="post" action="/admin/shipments/<%= shipment.id %>/status">
					<div class="row g-2">
						<div class="col-md-5">
							<select class="form-select" name="status_id" required>
								<option value="">Select status</option>
								<% statuses.forEach(st => { %>
									<option value="<%= st.id %>"><%= st.name %></option>
								<% }) %>
							</select>
						</div>
						<div class="col-md-7">
							<input class="form-control" name="note" placeholder="Optional note">
						</div>
					</div>
					<div class="mt-3">
						<button class="btn btn-primary">Add Status</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<div class="card mt-3 shadow-sm">
	<div class="card-header">Status History</div>
	<div class="card-body">
		<div class="table-responsive">
			<table class="table table-sm align-middle">
				<thead>
					<tr>
						<th>Time</th>
						<th>Status</th>
						<th>Note</th>
						<th>By</th>
					</tr>
				</thead>
				<tbody>
					<% history.forEach(h => { %>
						<tr>
							<td><%= new Date(h.changed_at).toLocaleString() %></td>
							<td><span class="badge" style="background:<%= h.status_color %>"><%= h.status_name %></span></td>
							<td><%= h.note || '' %></td>
							<td><%= h.changed_by_name || '—' %></td>
						</tr>
					<% }) %>
				</tbody>
			</table>
		</div>
	</div>
</div>
